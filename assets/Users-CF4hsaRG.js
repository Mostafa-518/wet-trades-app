import{r as m,j as e,C as q,a as V,b as z,c as Q,B as P,I as E,T as Oe,d as Le,e as K,f as v,g as Ie,h as y,Y as $e,Z as qe,$ as Ve,s as k,z as Z,G as ze,J as Qe,a0 as Ke,M as j,N as J,m as Be,a1 as Ge,a2 as I,a3 as He,l as We,n as Ye,o as Ze,a4 as Je,R as Xe}from"./index-CUi0-ZAd.js";import{P as ea}from"./plus-DeNOSqH0.js";import{S as aa}from"./search-V0kBukTT.js";import{C as sa,f as ta,U as ra}from"./UserDetailView-DZWSjwk7.js";import{C as la}from"./calendar-CxMCzwfL.js";import{E as oa}from"./eye-Cc6JYlaG.js";import{S as na}from"./square-pen-Dgoysi4y.js";import{T as ia}from"./trash-2-D2XXXdCF.js";import{f as X,R as ca,P as da,W as ma,C as ua,T as pa,g as ga,h as ee,O as xa,i as ha,D as fa,a as ja,b as va,c as ya,d as wa}from"./dialog-5aNDVFb2.js";import{u as Na,e as ba,F as w,a as N,b,c as A,d as C}from"./form-D7lAEv9F.js";import{t as Aa,o as Ca,s as D,e as B}from"./types-CPjX06rk.js";import{S as G,a as H,b as W,c as Y,d as S}from"./select-DBe7YI5z.js";import{A as Da}from"./AvatarUpload-BHyf8YS1.js";import{U as O}from"./userService-DCmGY_gB.js";import{logUserManagementAction as M}from"./dataAccessLogger-D-lZ_vaL.js";import{P as Sa}from"./PermissionGuard-DBI3Qweg.js";import"./user-D0Rtvshz.js";import"./phone-DlwlF_Lc.js";import"./formatDistance-BGkT52mR.js";import"./index-CYfJLrVV.js";function Ua({users:a,onAdd:s,onEdit:t,onDelete:n,onView:c,loading:l=!1,canModify:d=!0}){const[i,u]=m.useState(""),o=a.filter(r=>r.name.toLowerCase().includes(i.toLowerCase())||r.email.toLowerCase().includes(i.toLowerCase())||r.department.toLowerCase().includes(i.toLowerCase())||r.role.toLowerCase().includes(i.toLowerCase())),g=r=>{switch(r){case"active":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"inactive":return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300";case"suspended":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"}},U=r=>{switch(r){case"admin":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";case"manager":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"viewer":return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"}},L=r=>r.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2),T=r=>{try{const _=new Date(r);return ta(_,{addSuffix:!0})}catch{return"Never"}};return l?e.jsxs(q,{children:[e.jsx(V,{children:e.jsx(z,{children:"Users Management"})}),e.jsx(Q,{children:e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading users..."})})})]}):e.jsxs(q,{children:[e.jsxs(V,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx(z,{className:"text-xl font-semibold",children:"Users Management"}),d&&s&&e.jsxs(P,{onClick:s,className:"w-full sm:w-auto",children:[e.jsx(ea,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(aa,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search users...",value:i,onChange:r=>u(r.target.value),className:"max-w-sm"})]})]}),e.jsxs(Q,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Oe,{children:[e.jsx(Le,{children:e.jsxs(K,{children:[e.jsx(v,{className:"w-[250px]",children:"User"}),e.jsx(v,{className:"hidden sm:table-cell",children:"Role"}),e.jsx(v,{className:"hidden md:table-cell",children:"Department"}),e.jsx(v,{className:"hidden lg:table-cell",children:"Status"}),e.jsx(v,{className:"hidden xl:table-cell",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(sa,{className:"h-4 w-4"}),"Last Login"]})}),e.jsx(v,{className:"hidden xl:table-cell",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(la,{className:"h-4 w-4"}),"Created"]})}),e.jsx(v,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Ie,{children:o.map(r=>e.jsxs(K,{className:"hover:bg-muted/50",children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs($e,{className:"h-10 w-10",children:[e.jsx(qe,{src:r.avatar,alt:r.name}),e.jsx(Ve,{className:"text-sm font-medium",children:L(r.name)})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium truncate",children:r.name}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:r.email}),e.jsxs("div",{className:"flex gap-2 mt-1 sm:hidden",children:[e.jsx(k,{variant:"secondary",className:`${U(r.role)} text-xs`,children:r.role}),e.jsx(k,{variant:"secondary",className:`${g(r.status)} text-xs`,children:r.status})]})]})]})}),e.jsx(y,{className:"hidden sm:table-cell",children:e.jsx(k,{variant:"secondary",className:U(r.role),children:r.role.charAt(0).toUpperCase()+r.role.slice(1)})}),e.jsx(y,{className:"hidden md:table-cell",children:r.department}),e.jsx(y,{className:"hidden lg:table-cell",children:e.jsx(k,{variant:"secondary",className:g(r.status),children:r.status.charAt(0).toUpperCase()+r.status.slice(1)})}),e.jsx(y,{className:"hidden xl:table-cell",children:e.jsx("div",{className:"text-sm",children:r.lastLogin?T(r.lastLogin):"Never"})}),e.jsx(y,{className:"hidden xl:table-cell",children:e.jsx("div",{className:"text-sm",children:T(r.createdAt)})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>c(r),className:"h-8 w-8 p-0",children:e.jsx(oa,{className:"h-4 w-4"})}),d&&t&&e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>t(r),className:"h-8 w-8 p-0",children:e.jsx(na,{className:"h-4 w-4"})}),d&&n&&e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>n(r.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-950",children:e.jsx(ia,{className:"h-4 w-4"})})]})})]},r.id))})]})}),o.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No users found."})})]})]})}var ae="AlertDialog",[Ta,gs]=ze(ae,[X]),f=X(),se=a=>{const{__scopeAlertDialog:s,...t}=a,n=f(s);return e.jsx(ca,{...n,...t,modal:!0})};se.displayName=ae;var _a="AlertDialogTrigger",Ea=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,c=f(t);return e.jsx(ha,{...c,...n,ref:s})});Ea.displayName=_a;var Pa="AlertDialogPortal",te=a=>{const{__scopeAlertDialog:s,...t}=a,n=f(s);return e.jsx(da,{...n,...t})};te.displayName=Pa;var Fa="AlertDialogOverlay",re=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,c=f(t);return e.jsx(xa,{...c,...n,ref:s})});re.displayName=Fa;var F="AlertDialogContent",[Ra,ka]=Ta(F),Ma=Ke("AlertDialogContent"),le=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,children:n,...c}=a,l=f(t),d=m.useRef(null),i=Z(s,d),u=m.useRef(null);return e.jsx(ma,{contentName:F,titleName:oe,docsSlug:"alert-dialog",children:e.jsx(Ra,{scope:t,cancelRef:u,children:e.jsxs(ua,{role:"alertdialog",...l,...c,ref:i,onOpenAutoFocus:Qe(c.onOpenAutoFocus,o=>{var g;o.preventDefault(),(g=u.current)==null||g.focus({preventScroll:!0})}),onPointerDownOutside:o=>o.preventDefault(),onInteractOutside:o=>o.preventDefault(),children:[e.jsx(Ma,{children:n}),e.jsx(La,{contentRef:d})]})})})});le.displayName=F;var oe="AlertDialogTitle",ne=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,c=f(t);return e.jsx(pa,{...c,...n,ref:s})});ne.displayName=oe;var ie="AlertDialogDescription",ce=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,c=f(t);return e.jsx(ga,{...c,...n,ref:s})});ce.displayName=ie;var Oa="AlertDialogAction",de=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,c=f(t);return e.jsx(ee,{...c,...n,ref:s})});de.displayName=Oa;var me="AlertDialogCancel",ue=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...n}=a,{cancelRef:c}=ka(me,t),l=f(t),d=Z(s,c);return e.jsx(ee,{...l,...n,ref:d})});ue.displayName=me;var La=({contentRef:a})=>{const s=`\`${F}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${F}\` by passing a \`${ie}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${F}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return m.useEffect(()=>{var n;document.getElementById((n=a.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(s)},[s,a]),null},Ia=se,$a=te,pe=re,ge=le,xe=de,he=ue,fe=ne,je=ce;const qa=Ia,Va=$a,ve=m.forwardRef(({className:a,...s},t)=>e.jsx(pe,{className:j("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t}));ve.displayName=pe.displayName;const ye=m.forwardRef(({className:a,...s},t)=>e.jsxs(Va,{children:[e.jsx(ve,{}),e.jsx(ge,{ref:t,className:j("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]}));ye.displayName=ge.displayName;const we=({className:a,...s})=>e.jsx("div",{className:j("flex flex-col space-y-2 text-center sm:text-left",a),...s});we.displayName="AlertDialogHeader";const Ne=({className:a,...s})=>e.jsx("div",{className:j("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});Ne.displayName="AlertDialogFooter";const be=m.forwardRef(({className:a,...s},t)=>e.jsx(fe,{ref:t,className:j("text-lg font-semibold",a),...s}));be.displayName=fe.displayName;const Ae=m.forwardRef(({className:a,...s},t)=>e.jsx(je,{ref:t,className:j("text-sm text-muted-foreground",a),...s}));Ae.displayName=je.displayName;const Ce=m.forwardRef(({className:a,...s},t)=>e.jsx(xe,{ref:t,className:j(J(),a),...s}));Ce.displayName=xe.displayName;const De=m.forwardRef(({className:a,...s},t)=>e.jsx(he,{ref:t,className:j(J({variant:"outline"}),"mt-2 sm:mt-0",a),...s}));De.displayName=he.displayName;const za=a=>Ca({name:D().min(2,"Name must be at least 2 characters"),email:D().email("Invalid email address"),role:B(["admin","procurement_manager","procurement_engineer","viewer"]),department:D().optional(),status:B(["active","inactive","suspended"]),phone:D().optional(),password:a?D().optional():D().optional().refine(s=>!s||s.length>=6,{message:"Password must be at least 6 characters"}),avatar:D().optional()});function Qa({user:a,onSubmit:s,onCancel:t}){const[n,c]=m.useState((a==null?void 0:a.avatar)||null),[l,d]=m.useState(!1),i=Na({resolver:Aa(za(!!a)),defaultValues:{name:(a==null?void 0:a.name)||"",email:(a==null?void 0:a.email)||"",role:(a==null?void 0:a.role)||"viewer",department:(a==null?void 0:a.department)||"General",status:(a==null?void 0:a.status)||"active",phone:(a==null?void 0:a.phone)||"",password:"",avatar:(a==null?void 0:a.avatar)||""}}),u=async o=>{if(console.log("=== UserForm handleSubmit called ==="),console.log("isSubmitting:",l),console.log("Form data received:",o),l){console.log("Already submitting, returning early");return}try{console.log("UserForm submitting:",o),d(!0);const g={...o,avatar:n||void 0};console.log("Final submit data:",g),console.log("Calling onSubmit with data:",g),await s(g),console.log("UserForm submit successful")}catch(g){throw console.error("UserForm submit error:",g),g}finally{console.log("Setting isSubmitting to false"),d(!1)}};return e.jsx(ba,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(u),className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(Da,{currentAvatar:n||void 0,name:i.watch("name")||"User",onAvatarChange:c})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6",children:[e.jsx(w,{control:i.control,name:"name",render:({field:o})=>e.jsxs(N,{children:[e.jsx(b,{children:"Full Name"}),e.jsx(A,{children:e.jsx(E,{placeholder:"Enter full name",...o})}),e.jsx(C,{})]})}),e.jsx(w,{control:i.control,name:"email",render:({field:o})=>e.jsxs(N,{children:[e.jsx(b,{children:"Email Address"}),e.jsx(A,{children:e.jsx(E,{type:"email",placeholder:"Enter email address",...o})}),e.jsx(C,{})]})}),e.jsx(w,{control:i.control,name:"role",render:({field:o})=>e.jsxs(N,{children:[e.jsx(b,{children:"Role"}),e.jsxs(G,{onValueChange:o.onChange,value:o.value,children:[e.jsx(A,{children:e.jsx(H,{children:e.jsx(W,{placeholder:"Select role"})})}),e.jsxs(Y,{children:[e.jsx(S,{value:"admin",children:"Admin"}),e.jsx(S,{value:"procurement_manager",children:"Procurement Manager"}),e.jsx(S,{value:"procurement_engineer",children:"Procurement Engineer"}),e.jsx(S,{value:"viewer",children:"Viewer"})]})]}),e.jsx(C,{})]})}),e.jsx(w,{control:i.control,name:"department",render:({field:o})=>e.jsxs(N,{children:[e.jsx(b,{children:"Department"}),e.jsx(A,{children:e.jsx(E,{placeholder:"Enter department",...o})}),e.jsx(C,{})]})}),e.jsx(w,{control:i.control,name:"status",render:({field:o})=>e.jsxs(N,{children:[e.jsx(b,{children:"Status"}),e.jsxs(G,{onValueChange:o.onChange,value:o.value,children:[e.jsx(A,{children:e.jsx(H,{children:e.jsx(W,{placeholder:"Select status"})})}),e.jsxs(Y,{children:[e.jsx(S,{value:"active",children:"Active"}),e.jsx(S,{value:"inactive",children:"Inactive"}),e.jsx(S,{value:"suspended",children:"Suspended"})]})]}),e.jsx(C,{})]})}),e.jsx(w,{control:i.control,name:"phone",render:({field:o})=>e.jsxs(N,{children:[e.jsx(b,{children:"Phone Number"}),e.jsx(A,{children:e.jsx(E,{placeholder:"Enter phone number",...o})}),e.jsx(C,{})]})}),!a&&e.jsx(w,{control:i.control,name:"password",render:({field:o})=>e.jsxs(N,{className:"md:col-span-2",children:[e.jsx(b,{children:"Temporary Password"}),e.jsx(A,{children:e.jsx(E,{type:"password",placeholder:"Enter temporary password",...o})}),e.jsx(C,{}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave empty to use default password (TempPassword123!). User should change it on first login."})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 pt-4",children:[e.jsx(P,{type:"button",variant:"outline",onClick:t,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(P,{type:"submit",disabled:l,className:"w-full sm:w-auto",children:l?a?"Updating...":"Creating...":a?"Update User":"Create User"})]})]})})}function Ka({isFormOpen:a,setIsFormOpen:s,isDeleteDialogOpen:t,setIsDeleteDialogOpen:n,editingUser:c,onFormSubmit:l,onFormCancel:d,onConfirmDelete:i,canModify:u,isDeleting:o}){return e.jsxs(e.Fragment,{children:[e.jsx(fa,{open:a,onOpenChange:s,children:e.jsxs(ja,{className:"max-w-2xl",children:[e.jsxs(va,{children:[e.jsx(ya,{children:c?"Edit User":"Add New User"}),e.jsx(wa,{children:c?"Update user information and permissions.":"Create a new user account with the required information."})]}),e.jsx(Qa,{user:c||void 0,onSubmit:l,onCancel:d})]})}),e.jsx(qa,{open:t,onOpenChange:n,children:e.jsxs(ye,{children:[e.jsxs(we,{children:[e.jsx(be,{children:"Are you sure?"}),e.jsx(Ae,{children:"This action cannot be undone. This will permanently delete the user account and remove all associated data."})]}),e.jsxs(Ne,{children:[e.jsx(De,{children:"Cancel"}),u&&e.jsx(Ce,{onClick:i,disabled:o,children:"Delete"})]})]})})]})}function Se(){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:,.<>?",t=new Uint8Array(16);crypto.getRandomValues(t);let n="";for(let u=0;u<16;u++)n+=a[t[u]%a.length];const c=/[A-Z]/.test(n),l=/[a-z]/.test(n),d=/[0-9]/.test(n),i=/[!@#$%^&*()_+\-=[\]{}|;:,.<>?]/.test(n);return!c||!l||!d||!i?Se():n}function Ba(){const{toast:a}=Be(),s=Ge(),t=I({mutationFn:async l=>{console.log("Creating new user with data:",l);const d=l.password||Se(),{data:i,error:u}=await He.auth.signUp({email:l.email,password:d,options:{emailRedirectTo:`${window.location.origin}/`,data:{full_name:l.name}}});if(u)throw console.error("Error creating user:",u),new Error(u.message);if(console.log("User created:",i.user),i.user){await new Promise(o=>setTimeout(o,2e3));try{await O.update(i.user.id,{full_name:l.name,role:l.role,phone:l.phone,avatar_url:l.avatar}),console.log("Profile updated with additional data")}catch(o){console.warn("Could not update additional profile data:",o)}}return i.user},onSuccess:()=>{s.invalidateQueries({queryKey:["users"]}),s.invalidateQueries({queryKey:["userProfile"]}),a({title:"User created",description:"The new user has been successfully created. They will receive a confirmation email with login instructions."})},onError:l=>{console.error("Create user mutation error:",l),a({title:"Error",description:l.message||"Failed to create user. Please check the email and try again.",variant:"destructive"})}}),n=I({mutationFn:async({id:l,userData:d})=>{console.log("Updating user with ID:",l,"Data:",d);const i={full_name:d.name,email:d.email,role:d.role,phone:d.phone,avatar_url:d.avatar};console.log("Mapped update data:",i);const u=await O.update(l,i);return console.log("Update result:",u),u},onSuccess:l=>{console.log("User update successful:",l),s.invalidateQueries({queryKey:["users"]}),s.invalidateQueries({queryKey:["userProfile"]}),s.invalidateQueries({queryKey:["auth"]}),s.refetchQueries({queryKey:["users"]}),a({title:"User updated",description:"The user has been successfully updated."})},onError:l=>{console.error("Update user mutation error:",l),a({title:"Error",description:l.message||"Failed to update user",variant:"destructive"})}}),c=I({mutationFn:async l=>await O.delete(l),onSuccess:()=>{s.invalidateQueries({queryKey:["users"]}),s.invalidateQueries({queryKey:["userProfile"]}),a({title:"User profile deleted",description:"The user profile has been successfully deleted."})},onError:l=>{console.error("Delete user mutation error:",l),a({title:"Error",description:l.message||"Failed to delete user",variant:"destructive"})}});return{createUserMutation:t,updateUserMutation:n,deleteUserMutation:c}}function Ga(){const a=We(),{profile:s}=Ye(),{canManageUsers:t}=Ze(),{createUserMutation:n,updateUserMutation:c,deleteUserMutation:l}=Ba(),[d,i]=m.useState(null),[u,o]=m.useState(!1),[g,U]=m.useState(!1),[L,T]=m.useState(!1),[r,_]=m.useState(null),[h,R]=m.useState(null),{data:Ue=[],isLoading:Te}=Je({queryKey:["users"],queryFn:async()=>(await O.getAll()).map(x=>({id:x.id,name:x.full_name||"",email:x.email||"",role:x.role,phone:x.phone||"",department:"General",status:"active",createdAt:x.created_at,lastLogin:x.last_login,avatar:x.avatar_url})),staleTime:0,refetchOnWindowFocus:!0});Xe.useEffect(()=>{var p;(p=a.state)!=null&&p.editUser&&(console.log("Opening edit form for user:",a.state.editUser),R(a.state.editUser),o(!0))},[a.state]);const _e=()=>{console.log("Adding new user"),R(null),o(!0)},$=p=>{console.log("Editing user:",p),R(p),o(!0),U(!1)},Ee=async p=>{console.log("Viewing user:",p),await M("profile_view",p.id),i(p),U(!0)},Pe=p=>{console.log("Requesting deletion for user:",p),_(p),T(!0)},Fe=async()=>{r&&(console.log("Confirming deletion for user:",r),await M("user_delete",r),l.mutate(r)),T(!1),_(null)},Re=async p=>{try{if(console.log("Submitting user form:",{editingUser:h==null?void 0:h.id,data:p}),h)p.role&&p.role!==h.role&&await M("role_change",h.id,{old_role:h.role,new_role:p.role}),console.log("Updating existing user:",h.id),await c.mutateAsync({id:h.id,userData:p});else{console.log("Creating new user");const x=await n.mutateAsync(p);x&&await M("user_create",x.id,{created_role:p.role})}console.log("User form submitted successfully"),o(!1),R(null)}catch(x){console.error("Error submitting user form:",x)}},ke=()=>{console.log("Canceling user form"),o(!1),R(null)},Me=()=>{U(!1),i(null)};return g&&d?e.jsx(ra,{user:d,onBack:Me,onEdit:t?$:()=>{}}):e.jsxs(e.Fragment,{children:[e.jsx(Ua,{users:Ue,onAdd:t?_e:void 0,onEdit:t?$:void 0,onDelete:t?Pe:void 0,onView:Ee,loading:Te,canModify:t}),e.jsx(Ka,{isFormOpen:u,setIsFormOpen:o,isDeleteDialogOpen:L,setIsDeleteDialogOpen:T,editingUser:h,onFormSubmit:Re,onFormCancel:ke,onConfirmDelete:Fe,canModify:t,isDeleting:l.isPending})]})}function xs(){return e.jsx(Sa,{permission:"manage_users",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"User Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage user accounts, roles, and permissions for your organization."})]}),e.jsx(Ga,{})]})})}export{xs as Users};
