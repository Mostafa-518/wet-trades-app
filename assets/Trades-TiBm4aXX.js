import{q as ue,i as ge,m as je,r as h,j as e,B as n,C as ne,a as ie,b as de,X as oe,c as me,I as se,s as ae,T as Te,d as Ce,e as te,f as w,g as Se,R as ke,h as N,k as Ie,n as Fe}from"./index-BW011E6G.js";import{T as _}from"./TableSelectionCheckbox-CnM1ep3P.js";import{r as De,u as Ee}from"./xlsx-CKN5doRT.js";import{P as H}from"./package-BXtjLS01.js";import{T as q}from"./trash-2-BLffjhfG.js";import{F as Ae}from"./file-down-C27BLe2c.js";import{P as V}from"./plus-BjXUjfi5.js";import{S as Le}from"./search-BW_M4e0M.js";import{C as he}from"./calendar-e18J0cHa.js";import{E as ze}from"./eye-DwuUZgn9.js";import{S as xe}from"./square-pen-DiJGTOgi.js";import{T as Me,a as Be}from"./TradeItemForm-C447iqGg.js";import"./index-DcX0hMW7.js";import"./form-B5Z4MJa0.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=ue("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=ue("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function $e({onCreateNew:T,onViewDetail:U,onEdit:v,onDelete:E,onBulkDelete:g,onAddItem:j,onEditItem:b,onDeleteItem:C,onBulkDeleteItems:f}){const{trades:X,tradeItems:S,addTrade:J}=ge(),{toast:A}=je(),[o,L]=h.useState({name:"",category:"",description:""}),k=h.useRef(null),[I,z]=h.useState(!1),[M,x]=h.useState(null),[d,t]=h.useState([]),[p,y]=h.useState([]),u=X.filter(s=>s.name.toLowerCase().includes(o.name.toLowerCase())&&s.category.toLowerCase().includes(o.category.toLowerCase())&&s.description.toLowerCase().includes(o.description.toLowerCase())),D=(s,c)=>{L(l=>({...l,[s]:c}))},B=()=>{L({name:"",category:"",description:""}),z(!1)},F=o.name||o.category||o.description,K=()=>{k.current&&(k.current.value="",k.current.click())},O=async s=>{var l;const c=(l=s.target.files)==null?void 0:l[0];if(c)try{const i=new FileReader;i.onload=async m=>{var ce;const r=new Uint8Array((ce=m.target)==null?void 0:ce.result),$=De(r,{type:"array"}),ee=$.SheetNames[0],ve=$.Sheets[ee],be=Ee.sheet_to_json(ve,{header:1}),[Pe,...ye]=be;let le=0,re=0;for(const P of ye)if(P.length>=3)try{await J({name:P[0]||"",category:P[1]||"",description:P[2]||""}),le++}catch(we){re++,console.error("Error importing trade:",we)}A({title:"Import Complete",description:`Successfully imported ${le} trades. ${re} errors.`})},i.readAsArrayBuffer(c)}catch(i){console.error("Error reading file:",i),A({title:"Import Error",description:"Failed to read the Excel file.",variant:"destructive"})}},R=s=>S.filter(c=>c.trade_id===s),Q=s=>{x(M===s?null:s)},W=s=>{t(s?u.map(c=>c.id):[])},Y=(s,c)=>{t(c?l=>[...l,s]:l=>l.filter(i=>i!==s))},Z=(s,c)=>{const l=R(s);if(c){const i=l.map(m=>m.id);y(m=>[...m,...i])}else{const i=l.map(m=>m.id);y(m=>m.filter(r=>!i.includes(r)))}},a=(s,c)=>{y(c?l=>[...l,s]:l=>l.filter(i=>i!==s))},fe=()=>{d.length>0&&g&&(g(d),t([]))},pe=()=>{p.length>0&&f&&(f(p),y([]))},Ne=u.length>0&&d.length===u.length;return d.length>0&&d.length<u.length,e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto",children:[e.jsx("input",{ref:k,type:"file",accept:".xlsx, .xls",className:"hidden",onChange:O,"data-testid":"import-excel-input"}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx(G,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Trades & Items"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage trades and their associated items"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-4 w-4"}),u.length," trades"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-4 w-4"}),S.length," items"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[d.length>0&&g&&e.jsxs(n,{variant:"destructive",onClick:fe,className:"shadow-sm",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Delete ",d.length," Trades"]}),p.length>0&&f&&e.jsxs(n,{variant:"destructive",onClick:pe,className:"shadow-sm",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Delete ",p.length," Items"]}),e.jsxs(n,{variant:"outline",onClick:K,className:"shadow-sm",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Import Excel"]}),T&&e.jsxs(n,{onClick:T,className:"shadow-sm",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Add New Trade"]})]})]})}),e.jsxs(ne,{className:"shadow-sm",children:[e.jsx(ie,{className:"bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5 text-blue-600"}),"Search Trades"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[F&&e.jsxs(n,{variant:"ghost",size:"sm",onClick:B,className:"text-red-600 hover:text-red-700",children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Clear"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>z(!I),className:I?"bg-blue-50 text-blue-700":"",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),I?"Simple Search":"Advanced Search"]})]})]})}),e.jsx(me,{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Trade Name"}),e.jsx(se,{placeholder:"Search by trade name...",value:o.name,onChange:s=>D("name",s.target.value),className:"bg-white"})]}),I&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Category"}),e.jsx(se,{placeholder:"Search by category...",value:o.category,onChange:s=>D("category",s.target.value),className:"bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Description"}),e.jsx(se,{placeholder:"Search by description...",value:o.description,onChange:s=>D("description",s.target.value),className:"bg-white"})]})]})]})})})]}),e.jsxs(ne,{className:"shadow-sm",children:[e.jsx(ie,{className:"bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-blue-600"}),"Trades (",u.length,")"]}),F&&e.jsx(ae,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Filtered Results"})]})}),e.jsx(me,{className:"p-0",children:u.length>0?e.jsx("div",{className:"overflow-hidden",children:e.jsxs(Te,{children:[e.jsx(Ce,{children:e.jsxs(te,{className:"bg-gray-50",children:[e.jsx(w,{className:"w-12",children:e.jsx(_,{checked:Ne,onCheckedChange:W,ariaLabel:"Select all trades"})}),e.jsx(w,{className:"font-semibold",children:"Trade Name"}),e.jsx(w,{className:"font-semibold",children:"Category"}),e.jsx(w,{className:"font-semibold",children:"Description"}),e.jsx(w,{className:"font-semibold text-center",children:"Items"}),e.jsx(w,{className:"font-semibold",children:"Created Date"}),e.jsx(w,{className:"text-right font-semibold",children:"Actions"})]})}),e.jsx(Se,{children:u.map((s,c)=>{const l=R(s.id),i=M===s.id,m=d.includes(s.id);return e.jsxs(ke.Fragment,{children:[e.jsxs(te,{className:c%2===0?"bg-white hover:bg-gray-50":"bg-gray-50 hover:bg-gray-100",children:[e.jsx(N,{children:e.jsx(_,{checked:m,onCheckedChange:r=>Y(s.id,r),ariaLabel:`Select trade ${s.name}`})}),e.jsx(N,{className:"font-medium text-gray-900",children:s.name}),e.jsx(N,{children:e.jsx(ae,{variant:"outline",className:"text-xs",children:s.category})}),e.jsx(N,{className:"text-gray-600 max-w-xs truncate",children:s.description}),e.jsx(N,{className:"text-center",children:e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>Q(s.id),className:"text-blue-600 hover:text-blue-800 hover:bg-blue-50",children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),l.length]})}),e.jsxs(N,{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),new Date(s.created_at).toLocaleDateString()]}),e.jsx(N,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>U(s.id),className:"h-8 w-8 p-0",children:e.jsx(ze,{className:"h-4 w-4"})}),v&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>v(s),className:"h-8 w-8 p-0",children:e.jsx(xe,{className:"h-4 w-4"})}),j&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>j(s.id),className:"h-8 w-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",children:e.jsx(V,{className:"h-4 w-4"})}),E&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>E(s.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(q,{className:"h-4 w-4"})})]})})]}),i&&e.jsx(te,{children:e.jsx(N,{colSpan:7,className:"bg-blue-50 p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-blue-600"}),"Trade Items (",l.length,")",l.length>0&&e.jsx(_,{checked:l.every(r=>p.includes(r.id)),onCheckedChange:r=>Z(s.id,r),ariaLabel:"Select all items in this trade"})]}),j&&e.jsxs(n,{size:"sm",onClick:()=>j(s.id),className:"shadow-sm",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Add Item"]})]}),l.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(r=>{const $=p.includes(r.id);return e.jsx("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(_,{checked:$,onCheckedChange:ee=>a(r.id,ee),ariaLabel:`Select item ${r.name}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.name}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1",children:e.jsx(ae,{variant:"outline",className:"text-xs",children:r.unit})}),e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:r.description}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),new Date(r.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-1 ml-3",children:[b&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>b(r),className:"h-7 w-7 p-0",children:e.jsx(xe,{className:"h-3 w-3"})}),C&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>C(r.id),className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(q,{className:"h-3 w-3"})})]})]})},r.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"bg-white rounded-full p-3 w-12 h-12 mx-auto mb-3 flex items-center justify-center",children:e.jsx(H,{className:"h-6 w-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No items found for this trade."})]})]})})})]},s.id)})})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-gray-50 rounded-full p-4 w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(G,{className:"h-10 w-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Trades Found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:F?"No trades match your search criteria.":"Get started by creating your first trade."}),F?e.jsxs(n,{variant:"outline",onClick:B,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Clear Filters"]}):T?e.jsxs(n,{onClick:T,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Create First Trade"]}):null]})})]})]})}function es(){const T=Ie(),[U,v]=h.useState(!1),[E,g]=h.useState(!1),[j,b]=h.useState(null),[C,f]=h.useState(null),[X,S]=h.useState(""),{addTrade:J,updateTrade:A,deleteTrade:o,bulkDeleteTrades:L,addTradeItem:k,updateTradeItem:I,deleteTradeItem:z,bulkDeleteTradeItems:M}=ge(),{toast:x}=je(),{profile:d}=Fe(),t=(d==null?void 0:d.role)!=="viewer",p=()=>{t&&(b(null),v(!0))},y=a=>{T(`/trades/${a}`)},u=a=>{t&&(b(a),v(!0))},D=a=>{t&&(o(a),x({title:"Trade deleted",description:"The trade has been removed successfully."}))},B=a=>{t&&(L(a),x({title:"Trades deleted",description:`${a.length} trades have been removed successfully.`}))},F=a=>{j?(A(j.id,a),x({title:"Trade updated",description:"The trade has been updated successfully."})):(J(a),x({title:"Trade created",description:"A new trade has been created successfully."})),v(!1),b(null)},K=()=>{v(!1),b(null)},O=a=>{t&&(S(a),f(null),g(!0))},R=a=>{t&&(f(a),g(!0))},Q=a=>{t&&(z(a),x({title:"Trade item deleted",description:"The trade item has been removed successfully."}))},W=a=>{t&&(M(a),x({title:"Trade items deleted",description:`${a.length} trade items have been removed successfully.`}))},Y=a=>{C?(I(C.id,a),x({title:"Trade item updated",description:"The trade item has been updated successfully."})):(k(a),x({title:"Trade item created",description:"A new trade item has been created successfully."})),g(!1),f(null),S("")},Z=()=>{g(!1),f(null),S("")};return U?e.jsx(Me,{trade:j,onSubmit:F,onCancel:K}):E?e.jsx(Be,{item:C,tradeId:X,onSubmit:Y,onCancel:Z}):e.jsx($e,{onCreateNew:t?p:void 0,onViewDetail:y,onEdit:t?u:void 0,onDelete:t?D:void 0,onBulkDelete:t?B:void 0,onAddItem:t?O:void 0,onEditItem:t?R:void 0,onDeleteItem:t?Q:void 0,onBulkDeleteItems:t?W:void 0})}export{es as Trades};
