import{q as ge,i as je,m as fe,r as h,j as e,B as c,C as ne,a as de,b as oe,X as me,c as he,I as ae,s as te,T as Te,d as Ce,e as le,f as w,g as Se,R as ke,h as N,k as Ie,n as Fe,o as De}from"./index-B-fhMUS3.js";import{T as _}from"./TableSelectionCheckbox-BgQxpWSU.js";import{r as Ee,u as Ae}from"./xlsx-CKN5doRT.js";import{P as H}from"./package-BvMTbakv.js";import{T as q}from"./trash-2-CtRfNH7u.js";import{F as Le}from"./file-down-DIGn1-KG.js";import{P as G}from"./plus-D9UoAsOA.js";import{S as ze}from"./search-B_p41cST.js";import{C as xe}from"./calendar-CaNse3A4.js";import{E as Me}from"./eye-CHQHiNQu.js";import{S as ue}from"./square-pen-OK-kRDBn.js";import{T as Be,a as Re}from"./TradeItemForm-CFORBNze.js";import{P as Pe}from"./PermissionGuard-N3pI0l66.js";import"./index-DFB4SIWy.js";import"./form-DN9n8LfF.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=ge("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=ge("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function _e({onCreateNew:T,onViewDetail:U,onEdit:v,onDelete:E,onBulkDelete:j,onAddItem:f,onEditItem:b,onDeleteItem:C,onBulkDeleteItems:p}){const{trades:X,tradeItems:S,addTrade:J}=je(),{toast:A}=fe(),[o,L]=h.useState({name:"",category:"",description:""}),k=h.useRef(null),[I,z]=h.useState(!1),[M,x]=h.useState(null),[g,n]=h.useState([]),[i,y]=h.useState([]),u=X.filter(s=>s.name.toLowerCase().includes(o.name.toLowerCase())&&s.category.toLowerCase().includes(o.category.toLowerCase())&&s.description.toLowerCase().includes(o.description.toLowerCase())),D=(s,r)=>{L(t=>({...t,[s]:r}))},B=()=>{L({name:"",category:"",description:""}),z(!1)},F=o.name||o.category||o.description,K=()=>{k.current&&(k.current.value="",k.current.click())},O=async s=>{var t;const r=(t=s.target.files)==null?void 0:t[0];if(r)try{const d=new FileReader;d.onload=async m=>{var ie;const l=new Uint8Array((ie=m.target)==null?void 0:ie.result),P=Ee(l,{type:"array"}),se=P.SheetNames[0],ve=P.Sheets[se],be=Ae.sheet_to_json(ve,{header:1}),[He,...ye]=be;let re=0,ce=0;for(const $ of ye)if($.length>=3)try{await J({name:$[0]||"",category:$[1]||"",description:$[2]||""}),re++}catch(we){ce++,console.error("Error importing trade:",we)}A({title:"Import Complete",description:`Successfully imported ${re} trades. ${ce} errors.`})},d.readAsArrayBuffer(r)}catch(d){console.error("Error reading file:",d),A({title:"Import Error",description:"Failed to read the Excel file.",variant:"destructive"})}},R=s=>S.filter(r=>r.trade_id===s),Q=s=>{x(M===s?null:s)},W=s=>{n(s?u.map(r=>r.id):[])},Y=(s,r)=>{n(r?t=>[...t,s]:t=>t.filter(d=>d!==s))},Z=(s,r)=>{const t=R(s);if(r){const d=t.map(m=>m.id);y(m=>[...m,...d])}else{const d=t.map(m=>m.id);y(m=>m.filter(l=>!d.includes(l)))}},ee=(s,r)=>{y(r?t=>[...t,s]:t=>t.filter(d=>d!==s))},a=()=>{g.length>0&&j&&(j(g),n([]))},pe=()=>{i.length>0&&p&&(p(i),y([]))},Ne=u.length>0&&g.length===u.length;return g.length>0&&g.length<u.length,e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto",children:[e.jsx("input",{ref:k,type:"file",accept:".xlsx, .xls",className:"hidden",onChange:O,"data-testid":"import-excel-input"}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx(V,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Trades & Items"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage trades and their associated items"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-4 w-4"}),u.length," trades"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-4 w-4"}),S.length," items"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[g.length>0&&j&&e.jsxs(c,{variant:"destructive",onClick:a,className:"shadow-sm",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Delete ",g.length," Trades"]}),i.length>0&&p&&e.jsxs(c,{variant:"destructive",onClick:pe,className:"shadow-sm",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Delete ",i.length," Items"]}),e.jsxs(c,{variant:"outline",onClick:K,className:"shadow-sm",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Import Excel"]}),T&&e.jsxs(c,{onClick:T,className:"shadow-sm",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Add New Trade"]})]})]})}),e.jsxs(ne,{className:"shadow-sm",children:[e.jsx(de,{className:"bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5 text-blue-600"}),"Search Trades"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[F&&e.jsxs(c,{variant:"ghost",size:"sm",onClick:B,className:"text-red-600 hover:text-red-700",children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),"Clear"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>z(!I),className:I?"bg-blue-50 text-blue-700":"",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),I?"Simple Search":"Advanced Search"]})]})]})}),e.jsx(he,{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Trade Name"}),e.jsx(ae,{placeholder:"Search by trade name...",value:o.name,onChange:s=>D("name",s.target.value),className:"bg-white"})]}),I&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Category"}),e.jsx(ae,{placeholder:"Search by category...",value:o.category,onChange:s=>D("category",s.target.value),className:"bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Description"}),e.jsx(ae,{placeholder:"Search by description...",value:o.description,onChange:s=>D("description",s.target.value),className:"bg-white"})]})]})]})})})]}),e.jsxs(ne,{className:"shadow-sm",children:[e.jsx(de,{className:"bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-blue-600"}),"Trades (",u.length,")"]}),F&&e.jsx(te,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Filtered Results"})]})}),e.jsx(he,{className:"p-0",children:u.length>0?e.jsx("div",{className:"overflow-hidden",children:e.jsxs(Te,{children:[e.jsx(Ce,{children:e.jsxs(le,{className:"bg-gray-50",children:[e.jsx(w,{className:"w-12",children:e.jsx(_,{checked:Ne,onCheckedChange:W,ariaLabel:"Select all trades"})}),e.jsx(w,{className:"font-semibold",children:"Trade Name"}),e.jsx(w,{className:"font-semibold",children:"Category"}),e.jsx(w,{className:"font-semibold",children:"Description"}),e.jsx(w,{className:"font-semibold text-center",children:"Items"}),e.jsx(w,{className:"font-semibold",children:"Created Date"}),e.jsx(w,{className:"text-right font-semibold",children:"Actions"})]})}),e.jsx(Se,{children:u.map((s,r)=>{const t=R(s.id),d=M===s.id,m=g.includes(s.id);return e.jsxs(ke.Fragment,{children:[e.jsxs(le,{className:r%2===0?"bg-white hover:bg-gray-50":"bg-gray-50 hover:bg-gray-100",children:[e.jsx(N,{children:e.jsx(_,{checked:m,onCheckedChange:l=>Y(s.id,l),ariaLabel:`Select trade ${s.name}`})}),e.jsx(N,{className:"font-medium text-gray-900",children:s.name}),e.jsx(N,{children:e.jsx(te,{variant:"outline",className:"text-xs",children:s.category})}),e.jsx(N,{className:"text-gray-600 max-w-xs truncate",children:s.description}),e.jsx(N,{className:"text-center",children:e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>Q(s.id),className:"text-blue-600 hover:text-blue-800 hover:bg-blue-50",children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),t.length]})}),e.jsxs(N,{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(xe,{className:"h-3 w-3"}),new Date(s.created_at).toLocaleDateString()]}),e.jsx(N,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>U(s.id),className:"h-8 w-8 p-0",children:e.jsx(Me,{className:"h-4 w-4"})}),v&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>v(s),className:"h-8 w-8 p-0",children:e.jsx(ue,{className:"h-4 w-4"})}),f&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>f(s.id),className:"h-8 w-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",children:e.jsx(G,{className:"h-4 w-4"})}),E&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>E(s.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(q,{className:"h-4 w-4"})})]})})]}),d&&e.jsx(le,{children:e.jsx(N,{colSpan:7,className:"bg-blue-50 p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-blue-600"}),"Trade Items (",t.length,")",t.length>0&&e.jsx(_,{checked:t.every(l=>i.includes(l.id)),onCheckedChange:l=>Z(s.id,l),ariaLabel:"Select all items in this trade"})]}),f&&e.jsxs(c,{size:"sm",onClick:()=>f(s.id),className:"shadow-sm",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"Add Item"]})]}),t.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(l=>{const P=i.includes(l.id);return e.jsx("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(_,{checked:P,onCheckedChange:se=>ee(l.id,se),ariaLabel:`Select item ${l.name}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.name}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1",children:e.jsx(te,{variant:"outline",className:"text-xs",children:l.unit})}),e.jsx("div",{className:"text-sm text-gray-600 mt-2",children:l.description}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 flex items-center gap-1",children:[e.jsx(xe,{className:"h-3 w-3"}),new Date(l.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-1 ml-3",children:[b&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>b(l),className:"h-7 w-7 p-0",children:e.jsx(ue,{className:"h-3 w-3"})}),C&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>C(l.id),className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(q,{className:"h-3 w-3"})})]})]})},l.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"bg-white rounded-full p-3 w-12 h-12 mx-auto mb-3 flex items-center justify-center",children:e.jsx(H,{className:"h-6 w-6 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No items found for this trade."})]})]})})})]},s.id)})})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-gray-50 rounded-full p-4 w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(V,{className:"h-10 w-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Trades Found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:F?"No trades match your search criteria.":"Get started by creating your first trade."}),F?e.jsxs(c,{variant:"outline",onClick:B,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Clear Filters"]}):T?e.jsxs(c,{onClick:T,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Create First Trade"]}):null]})})]})]})}function ts(){const T=Ie(),[U,v]=h.useState(!1),[E,j]=h.useState(!1),[f,b]=h.useState(null),[C,p]=h.useState(null),[X,S]=h.useState(""),{addTrade:J,updateTrade:A,deleteTrade:o,bulkDeleteTrades:L,addTradeItem:k,updateTradeItem:I,deleteTradeItem:z,bulkDeleteTradeItems:M}=je(),{toast:x}=fe(),{profile:g}=Fe(),{canModify:n,canDelete:i}=De(),y=()=>{n&&(b(null),v(!0))},u=a=>{T(`/trades/${a}`)},D=a=>{n&&(b(a),v(!0))},B=a=>{i&&(o(a),x({title:"Trade deleted",description:"The trade has been removed successfully."}))},F=a=>{i&&(L(a),x({title:"Trades deleted",description:`${a.length} trades have been removed successfully.`}))},K=a=>{f?(A(f.id,a),x({title:"Trade updated",description:"The trade has been updated successfully."})):(J(a),x({title:"Trade created",description:"A new trade has been created successfully."})),v(!1),b(null)},O=()=>{v(!1),b(null)},R=a=>{n&&(S(a),p(null),j(!0))},Q=a=>{n&&(p(a),j(!0))},W=a=>{i&&(z(a),x({title:"Trade item deleted",description:"The trade item has been removed successfully."}))},Y=a=>{i&&(M(a),x({title:"Trade items deleted",description:`${a.length} trade items have been removed successfully.`}))},Z=a=>{C?(I(C.id,a),x({title:"Trade item updated",description:"The trade item has been updated successfully."})):(k(a),x({title:"Trade item created",description:"A new trade item has been created successfully."})),j(!1),p(null),S("")},ee=()=>{j(!1),p(null),S("")};return U?e.jsx(Be,{trade:f,onSubmit:K,onCancel:O}):E?e.jsx(Re,{item:C,tradeId:X,onSubmit:Z,onCancel:ee}):e.jsx(Pe,{permission:"manage_trades",children:e.jsx(_e,{onCreateNew:n?y:void 0,onViewDetail:u,onEdit:n?D:void 0,onDelete:i?B:void 0,onBulkDelete:i?F:void 0,onAddItem:n?R:void 0,onEditItem:n?Q:void 0,onDeleteItem:i?W:void 0,onBulkDeleteItems:i?Y:void 0})})}export{ts as Trades};
