import{k as F,V as A,i as E,j as e,B as d,A as L,C as m,a as V,b as B,c as x}from"./index-BPW1VvWz.js";import{u as H}from"./useSubcontractHelpers-B_sc0bGH.js";import{u as z,f as D,b as O}from"./useSubcontractFiltering-CToR7nyq.js";import{E as R}from"./eye-B-LzYir9.js";import{S as U}from"./square-pen-DFR6Yo74.js";function K(){var g;const i=F(),[a]=A(),{subcontracts:f,projects:u,subcontractors:h,isLoading:N}=E(),{getProjectName:b,getSubcontractorName:y}=H(),p=a.get("projectId"),j=a.get("subcontractorId"),v=a.get("month"),S=a.get("year"),c=a.get("location"),n=a.get("trades"),l=a.get("projectName"),w=a.get("projectCode"),C=((g=a.get("facilities"))==null?void 0:g.split(",").filter(Boolean))||[],s={month:v||"all",year:S||"all",location:c||"all",trades:n||"all",projectName:l||"all",projectCode:w||"all",facilities:C},o=z(f,s),k=()=>{if(p&&u.length>0){const t=u.find(r=>r.id===p);return`Subcontracts for Project: ${(t==null?void 0:t.name)||"Unknown Project"}`}if(j&&h.length>0){const t=h.find(r=>r.id===j);return`Subcontracts for Subcontractor: ${(t==null?void 0:t.companyName)||"Unknown Subcontractor"}`}return l&&l!=="all"?`Subcontracts for Project: ${l}`:c&&c!=="all"?`Subcontracts for Location: ${c}`:n&&n!=="all"?`Subcontracts for Trade: ${n}`:"Filtered Subcontracts"},I=t=>{i(`/subcontracts/${t}`)},P=t=>{i(`/subcontracts/${t}?edit=true`)},T=()=>{i("/report",{replace:!0}),window.location.hash="#/report",window.location.search=""};return N?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading subcontracts..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(d,{variant:"outline",onClick:T,className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Back to Report"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:k()}),e.jsxs("p",{className:"text-muted-foreground",children:[o.length," subcontract",o.length!==1?"s":""," found"]})]})]})}),Object.values(s).some(t=>Array.isArray(t)?t.length>0:t!=="all")&&e.jsxs(m,{children:[e.jsx(V,{children:e.jsx(B,{className:"text-lg",children:"Applied Filters"})}),e.jsx(x,{children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.month!=="all"&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm",children:["Month: ",s.month]}),s.year!=="all"&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm",children:["Year: ",s.year]}),s.location!=="all"&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm",children:["Location: ",s.location]}),s.trades!=="all"&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm",children:["Trade: ",s.trades]}),s.projectName!=="all"&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm",children:["Project: ",s.projectName]}),s.facilities.length>0&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm",children:["Facilities: ",s.facilities.join(", ")]})]})})]}),o.length===0?e.jsx(m,{children:e.jsx(x,{className:"py-12",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No subcontracts found for this context."}),e.jsx("p",{children:"Try adjusting your filters or check if data exists for the selected criteria."})]})})}):e.jsx("div",{className:"grid gap-4",children:o.map(t=>e.jsx(m,{className:"hover:shadow-md transition-shadow",children:e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 items-center",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h3",{className:"font-semibold text-lg text-blue-600",children:t.contractId}),e.jsx("p",{className:"text-sm text-muted-foreground",children:D(t.dateOfIssuing)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:b(t.project)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Project"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:y(t.subcontractor)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Subcontractor"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:O(t.totalValue||0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Value"})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>I(t.id),children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>P(t.id),children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),"Edit"]})]})]}),t.tradeItems&&t.tradeItems.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Trade Items:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tradeItems.map((r,$)=>e.jsxs("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs",children:[r.trade," - ",r.item]},$))})]})]})},t.id))})]})}export{K as FilteredSubcontracts};
