const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-E73mDSPa.js","assets/index-BPW1VvWz.js","assets/index-DsqQRkb9.css"])))=>i.map(i=>d[i]);
import{q as U,j as e,C as h,a as b,b as v,F as y,c as g,T as A,d as $,e as D,f as N,g as R,h as p,s as f,_ as L,i as E,m as O,B as F,A as z,p as B,k as V,r as _}from"./index-BPW1VvWz.js";import{T as q,a as M,b as S,c as T}from"./tabs-B6xfFTeD.js";import{S as G}from"./square-pen-DFR6Yo74.js";import{D as H}from"./download-CF-dDwPE.js";import{P as C}from"./package-Ck9FDWVt.js";import{C as P}from"./calendar-DELl11KV.js";import{B as I}from"./building-2-DhVEZ2wc.js";import{U as W}from"./user-By2AGZZn.js";import{S as Q}from"./SubcontractEditModal-D_PCY77h.js";import"./useSubcontractHelpers-B_sc0bGH.js";import"./select-MYwvS03t.js";import"./index-C21_ivdF.js";import"./textarea-CZbeP3TU.js";import"./search-Ch82RnhM.js";import"./plus-CSoG-sTs.js";import"./trash-2-BWsomAQA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=U("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);function K({tradeItems:t,totalValue:m}){const j=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:0}).format(r),d=r=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0}).format(r);return e.jsxs(h,{className:"shadow-sm",children:[e.jsx(b,{className:"bg-gray-50",children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-blue-600"}),"Trade Items (",t.length,")"]})}),e.jsx(g,{className:"p-0",children:t.length>0?e.jsx("div",{className:"overflow-hidden",children:e.jsxs(A,{children:[e.jsx($,{children:e.jsxs(D,{className:"bg-gray-50",children:[e.jsx(N,{className:"font-semibold",children:"Trade"}),e.jsx(N,{className:"font-semibold",children:"Item"}),e.jsx(N,{className:"font-semibold",children:"Unit"}),e.jsx(N,{className:"text-right font-semibold",children:"Qty"}),e.jsx(N,{className:"text-right font-semibold",children:"Unit Price"}),e.jsx(N,{className:"text-right font-semibold",children:"Wastage %"}),e.jsx(N,{className:"text-right font-semibold",children:"Total Amount"})]})}),e.jsxs(R,{children:[t.map((r,a)=>{r.quantity*r.unitPrice;const i=r.wastagePercentage||0;return e.jsxs(D,{className:a%2===0?"bg-white":"bg-gray-50",children:[e.jsx(p,{className:"font-medium text-gray-900",children:e.jsx(f,{variant:"outline",className:"text-xs text-center",children:r.trade})}),e.jsx(p,{className:"font-medium",children:r.item}),e.jsx(p,{children:e.jsx(f,{variant:"outline",className:"text-xs",children:r.unit})}),e.jsx(p,{className:"text-right font-medium",children:d(r.quantity)}),e.jsx(p,{className:"text-right",children:j(r.unitPrice)}),e.jsx(p,{className:"text-right",children:i>0?e.jsxs(f,{variant:"outline",className:"text-orange-600 border-orange-200 bg-orange-50",children:[i,"%"]}):e.jsx("span",{className:"text-muted-foreground",children:"0%"})}),e.jsx(p,{className:"text-right font-bold text-green-600",children:j(r.total)})]},r.id)}),e.jsxs(D,{className:"border-t-2 bg-green-50",children:[e.jsx(p,{colSpan:6,className:"font-bold text-lg",children:"Total Contract Value"}),e.jsx(p,{className:"text-right font-bold text-xl text-green-700",children:j(m)})]})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-gray-50 rounded-full p-4 w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(y,{className:"h-10 w-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Trade Items"}),e.jsx("p",{className:"text-gray-500",children:"This subcontract doesn't have any trade items yet."})]})})]})}function X({responsibilities:t}){return e.jsxs(h,{children:[e.jsx(b,{children:e.jsx(v,{children:"Responsibilities"})}),e.jsx(g,{children:t.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(m=>e.jsx(f,{variant:"secondary",className:"px-3 py-1",children:m},m))}):e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No responsibilities assigned yet"})})]})}function Y({description:t}){return t?e.jsxs(h,{children:[e.jsx(b,{children:e.jsx(v,{children:"Description"})}),e.jsx(g,{children:e.jsx("p",{className:"text-sm",children:t})})]}):null}const Z=async({subcontract:t,projectName:m,subcontractorName:j,subcontractorData:d})=>{const r=await L(()=>import("./jspdf.es.min-E73mDSPa.js").then(n=>n.j),__vite__mapDeps([0,1,2])),a=new r.default,i=a.internal.pageSize.getWidth();let s=20;const l=(n,o,w,k)=>{a.text(n,o,w,k)},x=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:0}).format(n);if(a.setFontSize(20),a.setFont(void 0,"bold"),l("SUBCONTRACT AGREEMENT",i/2,s,{align:"center"}),s+=15,a.setFontSize(12),a.setFont(void 0,"normal"),l(`Contract ID: ${t.contractId}`,i/2,s,{align:"center"}),s+=20,a.setFontSize(14),a.setFont(void 0,"bold"),l("CONTRACT INFORMATION",20,s),s+=10,a.setFontSize(11),a.setFont(void 0,"normal"),l(`Project: ${m}`,20,s),s+=7,l(`Subcontractor: ${j}`,20,s),s+=7,l(`Contract Type: ${t.contractType==="ADD"?"Addendum":"Subcontract"}`,20,s),s+=7,l(`Status: ${t.status.charAt(0).toUpperCase()+t.status.slice(1)}`,20,s),s+=7,l(`Total Value: ${x(t.totalValue)}`,20,s),s+=7,t.dateOfIssuing&&(l(`Date of Issuing: ${new Date(t.dateOfIssuing).toLocaleDateString()}`,20,s),s+=7),t.startDate&&(l(`Start Date: ${new Date(t.startDate).toLocaleDateString()}`,20,s),s+=7),t.endDate&&(l(`End Date: ${new Date(t.endDate).toLocaleDateString()}`,20,s),s+=7),s+=10,d&&(a.setFontSize(14),a.setFont(void 0,"bold"),l("SUBCONTRACTOR DETAILS",20,s),s+=10,a.setFontSize(11),a.setFont(void 0,"normal"),l(`Company: ${d.companyName}`,20,s),s+=7,d.representativeName&&(l(`Representative: ${d.representativeName}`,20,s),s+=7),d.phone&&(l(`Phone: ${d.phone}`,20,s),s+=7),d.email&&(l(`Email: ${d.email}`,20,s),s+=7),s+=10),t.tradeItems&&t.tradeItems.length>0&&(s>200&&(a.addPage(),s=20),a.setFontSize(14),a.setFont(void 0,"bold"),l("TRADE ITEMS",20,s),s+=10,a.setFontSize(10),a.setFont(void 0,"bold"),l("Trade",20,s),l("Item",60,s),l("Qty",120,s),l("Unit",140,s),l("Unit Price",160,s),l("Total",180,s),s+=7,a.line(20,s-2,200,s-2),s+=3,a.setFont(void 0,"normal"),t.tradeItems.forEach(n=>{var o;s>270&&(a.addPage(),s=20),l(n.trade||"",20,s),l(n.item||"",60,s),l(((o=n.quantity)==null?void 0:o.toString())||"0",120,s),l(n.unit||"",140,s),l(x(n.unitPrice||0),160,s),l(x(n.total||0),180,s),s+=7}),s+=10,a.setFont(void 0,"bold"),a.line(160,s-5,200,s-5),l(`TOTAL: ${x(t.totalValue)}`,160,s),s+=15),t.responsibilities&&t.responsibilities.length>0&&(s>220&&(a.addPage(),s=20),a.setFontSize(14),a.setFont(void 0,"bold"),l("RESPONSIBILITIES",20,s),s+=10,a.setFontSize(11),a.setFont(void 0,"normal"),t.responsibilities.forEach((n,o)=>{s>270&&(a.addPage(),s=20),l(`${o+1}. ${n}`,20,s),s+=7})),t.description){s>220&&(a.addPage(),s=20),a.setFontSize(14),a.setFont(void 0,"bold"),l("DESCRIPTION",20,s),s+=10,a.setFontSize(11),a.setFont(void 0,"normal");const n=a.splitTextToSize(t.description,170);a.text(n,20,s)}const c=a.internal.pages.length-1;for(let n=1;n<=c;n++)a.setPage(n),a.setFontSize(8),a.setFont(void 0,"normal"),l(`Generated on ${new Date().toLocaleDateString()} - Page ${n} of ${c}`,i/2,285,{align:"center"});const u=`${t.contractId}_contract.pdf`;a.save(u)};function ee({subcontract:t,onBack:m,onEdit:j}){const{projects:d,subcontractors:r}=E(),{toast:a}=O(),i=d.find(n=>n.id===t.project),s=r.find(n=>n.id===t.subcontractor),l=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:0}).format(n),x=()=>{if(t.pdfUrl){try{window.open(t.pdfUrl,"_blank","noopener"),a({title:"Opening link",description:"Contract PDF link opened in a new tab."})}catch(n){console.error("Error opening PDF link:",n),a({title:"Error",description:"Failed to open the PDF link.",variant:"destructive"})}return}try{Z({subcontract:t,projectName:(i==null?void 0:i.name)||"Unknown Project",subcontractorName:(s==null?void 0:s.companyName)||"Unknown Subcontractor",subcontractorData:s}),a({title:"PDF Generated",description:"Contract PDF has been downloaded successfully"})}catch(n){console.error("Error generating PDF:",n),a({title:"Error",description:"Failed to generate PDF. Please try again.",variant:"destructive"})}},c=n=>{const o={draft:{color:"bg-gray-100 text-gray-800",label:"Draft"},pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending"},active:{color:"bg-blue-100 text-blue-800",label:"Active"},completed:{color:"bg-green-100 text-green-800",label:"Completed"},cancelled:{color:"bg-red-100 text-red-800",label:"Cancelled"},overbudget:{color:"bg-red-100 text-red-800",label:"Over Budget"}},w=o[n]||o.draft;return e.jsx(f,{className:w.color,children:w.label})},u=(n,o)=>n==="ADD"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{variant:"outline",className:"bg-purple-50 text-purple-700 border-purple-200",children:"Addendum"}),o&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["#",o]})]}):e.jsx(f,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Subcontract"});return e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(F,{variant:"outline",onClick:m,className:"shadow-sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Back to Subcontracts"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx(y,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:t.contractId}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[u(t.contractType,t.addendumNumber),e.jsx("span",{className:"text-sm text-muted-foreground",children:"•"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:(i==null?void 0:i.name)||"Unknown Project"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c(t.status),e.jsxs(F,{variant:"outline",onClick:j,className:"shadow-sm",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(F,{variant:"outline",onClick:x,className:"shadow-sm",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Download PDF"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(h,{className:"border-l-4 border-l-green-500 shadow-sm",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-50 p-3 rounded-full",children:e.jsx(J,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l(t.totalValue)}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Contract Value"})]})]})})}),e.jsx(h,{className:"border-l-4 border-l-purple-500 shadow-sm",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-purple-50 p-3 rounded-full",children:e.jsx(C,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.tradeItems.length}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Trade Items"})]})]})})}),e.jsx(h,{className:"border-l-4 border-l-blue-500 shadow-sm",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-50 p-3 rounded-full",children:e.jsx(P,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c(t.status)}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Status"})]})]})})}),e.jsx(h,{className:"border-l-4 border-l-orange-500 shadow-sm",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-orange-50 p-3 rounded-full",children:e.jsx(y,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:t.responsibilities.length}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Responsibilities"})]})]})})})]}),e.jsxs(q,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(M,{className:"grid w-full grid-cols-4 bg-gray-100",children:[e.jsxs(S,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Overview"]}),e.jsxs(S,{value:"items",className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),"Trade Items"]}),e.jsxs(S,{value:"responsibilities",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Responsibilities"]}),e.jsxs(S,{value:"timeline",className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Timeline"]})]}),e.jsxs(T,{value:"overview",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{className:"shadow-sm",children:[e.jsx(b,{className:"bg-gray-50",children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-blue-600"}),"Contract Information"]})}),e.jsxs(g,{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Contract ID"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:t.contractId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Contract Type"}),e.jsx("div",{className:"mt-1",children:u(t.contractType,t.addendumNumber)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Total Value"}),e.jsx("p",{className:"text-lg font-semibold text-green-600 mt-1",children:l(t.totalValue)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Status"}),e.jsx("div",{className:"mt-1",children:c(t.status)})]}),t.dateOfIssuing&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Date of Issuing"}),e.jsx("p",{className:"text-lg text-gray-900 mt-1",children:new Date(t.dateOfIssuing).toLocaleDateString()})]})]})]}),e.jsxs(h,{className:"shadow-sm",children:[e.jsx(b,{className:"bg-gray-50",children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-blue-600"}),"Project & Subcontractor"]})}),e.jsxs(g,{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Project"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:(i==null?void 0:i.name)||"Unknown Project"}),i&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.code," • ",i.location]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Subcontractor"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:(s==null?void 0:s.companyName)||"Unknown Subcontractor"}),s&&e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Representative: ",s.representativeName]}),e.jsxs("p",{children:["Phone: ",s.phone]}),e.jsxs("p",{children:["Email: ",s.email]})]})]})]})]})]}),t.description&&e.jsx(Y,{description:t.description})]}),e.jsx(T,{value:"items",children:e.jsx(K,{tradeItems:t.tradeItems,totalValue:t.totalValue})}),e.jsx(T,{value:"responsibilities",children:e.jsx(X,{responsibilities:t.responsibilities})}),e.jsx(T,{value:"timeline",children:e.jsxs(h,{className:"shadow-sm",children:[e.jsx(b,{className:"bg-gray-50",children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-blue-600"}),"Contract Timeline"]})}),e.jsx(g,{className:"p-6",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.startDate&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Start Date"}),e.jsx("p",{className:"text-lg text-gray-900 mt-1",children:new Date(t.startDate).toLocaleDateString()})]}),t.endDate&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"End Date"}),e.jsx("p",{className:"text-lg text-gray-900 mt-1",children:new Date(t.endDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Created"}),e.jsx("p",{className:"text-lg text-gray-900 mt-1",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Last Updated"}),e.jsx("p",{className:"text-lg text-gray-900 mt-1",children:new Date(t.updatedAt).toLocaleDateString()})]})]})})})]})})]})]})}function ue(){const{id:t}=B(),m=V(),{subcontracts:j,updateSubcontract:d}=E(),[r,a]=_.useState(!1),i=()=>{m("/subcontracts")},s=()=>{console.log("Edit button clicked, opening modal"),a(!0)},l=async(c,u)=>{console.log("Saving subcontract edit:",c,u),await d(c,u),a(!1)};if(!t)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Contract Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"The requested contract could not be found."})]});const x=j.find(c=>c.id===t);return x?e.jsxs(e.Fragment,{children:[e.jsx(ee,{subcontract:x,onBack:i,onEdit:s}),r&&e.jsx(Q,{subcontract:x,open:r,onClose:()=>a(!1),onSave:l})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Contract Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"The requested contract could not be found."})]})}export{ue as SubcontractDetail};
