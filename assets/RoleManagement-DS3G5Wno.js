import{m as _,a1 as h,a4 as j,a2 as v,j as e,C as t,a as i,b as c,c as d,L as b,s as o,B as f}from"./index-BPW1VvWz.js";import{U as l}from"./userService-BB80T-Cr.js";import{P as y}from"./PermissionGuard-DtGoeeeN.js";const N={read:"View Data",create:"Create Records",update:"Update Records",delete:"Delete Records",manage_users:"Manage Users",view_reports:"View Reports",manage_projects:"Manage Projects",manage_subcontractors:"Manage Subcontractors",manage_trades:"Manage Trades",manage_responsibilities:"Manage Responsibilities",manage_subcontracts:"Manage Subcontracts"};function R(){const{toast:r}=_(),m=h(),{data:u=[],isLoading:p}=j({queryKey:["users"],queryFn:async()=>(await l.getAll()).map(s=>({id:s.id,name:s.full_name||"",email:s.email||"",role:s.role,phone:s.phone||"",department:"General",status:"active",createdAt:s.created_at,lastLogin:s.last_login,avatar:s.avatar_url}))}),n=v({mutationFn:async({userId:a,role:s})=>await l.update(a,{role:s}),onSuccess:()=>{m.invalidateQueries({queryKey:["users"]}),r({title:"Role updated",description:"User role has been successfully updated."})},onError:a=>{r({title:"Error",description:a.message||"Failed to update user role",variant:"destructive"})}}),g=(a,s)=>{n.mutate({userId:a,role:s})},x=a=>({admin:["read","create","update","delete","manage_users","view_reports","manage_projects","manage_subcontractors","manage_trades","manage_responsibilities","manage_subcontracts"],procurement_manager:["read","create","update","view_reports","manage_projects","manage_subcontractors","manage_trades","manage_responsibilities","manage_subcontracts"],procurement_engineer:["read","create","update","view_reports","manage_subcontractors","manage_trades","manage_responsibilities","manage_subcontracts"],viewer:["read","view_reports"]})[a]||[];return p?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Role & Permission Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage user roles and their associated permissions."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:["admin","procurement_manager","procurement_engineer","viewer"].map(a=>e.jsxs(t,{children:[e.jsx(i,{children:e.jsx(c,{className:"capitalize",children:a.replace("_"," ")})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"Permissions:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:x(a).map(s=>e.jsx(o,{variant:"secondary",className:"text-xs",children:N[s]},s))})]})})]},a))}),e.jsxs(t,{children:[e.jsx(i,{children:e.jsx(c,{children:"User Role Assignment"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:u.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:a.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.email})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(o,{variant:a.role==="admin"?"default":a.role==="procurement_manager"||a.role==="procurement_engineer"?"secondary":"outline",children:a.role.replace("_"," ")}),e.jsx("div",{className:"flex gap-2",children:["admin","procurement_manager","procurement_engineer","viewer"].map(s=>e.jsx(f,{variant:a.role===s?"default":"outline",size:"sm",onClick:()=>g(a.id,s),disabled:n.isPending,children:s.replace("_"," ")},s))})]})]},a.id))})})]})]})}function P(){return e.jsx(y,{permission:"manage_users",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Admin Control Panel"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage user roles and control system access permissions."})]}),e.jsx(R,{})]})})}export{P as RoleManagementPage};
